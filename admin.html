<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - CETIS No. 45 "José María Izazaga"</title>
    <style>
        @page { 
            size: A4; 
            margin: 8mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #003f7f 0%, #1e4a72 50%, #d52b1e 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
        }
        
        .admin-header {
            background: linear-gradient(135deg, #8b1538, #a91d47);
            color: white;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .institutional-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-mini {
            width: 45px;
            height: 45px;
            background: #ffc72c;
            border: 3px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 12px;
            color: #8b1538;
            text-shadow: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }
        
        .institution-info {
            flex: 1;
            margin: 0 20px;
            text-align: center;
        }
        
        .institution-name {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 5px;
            color: #ffc72c;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            line-height: 1.1;
        }
        
        .institution-subtitle {
            font-size: 1em;
            opacity: 0.95;
            font-weight: 400;
            margin-bottom: 5px;
        }
        
        .institution-location {
            font-size: 1.1em;
            color: #ffc72c;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            font-style: italic;
        }
        
        .admin-title {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .admin-subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 199, 44, 0.2);
            color: #ffc72c;
            border: 2px solid #ffc72c;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #ffc72c;
            color: #8b1538;
            transform: translateY(-2px);
        }
        
        .admin-content {
            padding: 30px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 5px solid #8b1538;
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-left-color: #ffc72c;
        }
        
        .dashboard-card.credentials-optimized {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
        }
        
        .dashboard-card.credentials-optimized:hover {
            border-left-color: #20c997;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
        }
        
        .card-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #8b1538;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title.optimized {
            color: #155724;
        }
        
        .card-content {
            color: #555;
            line-height: 1.6;
        }
        
        .stats-mini-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .mini-stat {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .mini-stat:hover {
            border-color: #8b1538;
            transform: scale(1.02);
        }
        
        .mini-stat.optimized:hover {
            border-color: #28a745;
        }
        
        .mini-stat-number {
            font-size: 1.8em;
            font-weight: 900;
            color: #8b1538;
            margin-bottom: 5px;
        }
        
        .mini-stat-number.optimized {
            color: #28a745;
        }
        
        .mini-stat-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #8b1538, #a91d47);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(139, 21, 56, 0.3);
            border: 2px solid transparent;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 21, 56, 0.4);
            border-color: #ffc72c;
        }
        
        .action-btn.success {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
        }
        
        .action-btn.success:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        
        .action-btn.secondary {
            background: linear-gradient(135deg, #003f7f, #1e4a72);
            box-shadow: 0 3px 10px rgba(0, 63, 127, 0.3);
        }
        
        .action-btn.secondary:hover {
            box-shadow: 0 5px 15px rgba(0, 63, 127, 0.4);
        }
        
        .alert-section {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 3px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(255, 193, 7, 0.2);
        }
        
        .alert-title {
            font-size: 1.6em;
            color: #856404;
            margin-bottom: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-content {
            color: #856404;
            font-weight: 500;
            line-height: 1.6;
        }
        
        .quick-actions {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 3px solid #28a745;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .quick-actions h3 {
            color: #155724;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .quick-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(40, 167, 69, 0.3);
            border: 2px solid transparent;
        }
        
        .quick-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
            border-color: white;
        }
        
        .data-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .table-header {
            background: linear-gradient(135deg, #8b1538, #a91d47);
            color: white;
            padding: 20px;
            font-weight: 700;
            font-size: 1.2em;
        }
        
        .table-content {
            padding: 20px;
        }
        
        .table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1.2fr;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
        }
        
        .table-row:hover {
            background: rgba(139, 21, 56, 0.05);
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            text-align: center;
            border: 2px solid;
        }
        
        .status-normal {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-color: #28a745;
        }
        
        .status-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-color: #ffc107;
        }
        
        .status-critical {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-color: #dc3545;
        }
        
        .footer-admin {
            background: linear-gradient(135deg, #003f7f, #1e4a72);
            color: white;
            text-align: center;
            padding: 25px;
            box-shadow: 0 -3px 15px rgba(0,0,0,0.2);
        }
        
        .footer-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .footer-logo {
            width: 35px;
            height: 35px;
            background: #ffc72c;
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 10px;
            color: #8b1538;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #8b1538;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-bar {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .chart-label {
            width: 100px;
            font-size: 0.9em;
            font-weight: 600;
            color: #555;
        }
        
        .chart-progress {
            flex: 1;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .chart-fill {
            height: 100%;
            background: linear-gradient(135deg, #8b1538, #a91d47);
            border-radius: 10px;
            transition: width 1s ease;
        }
        
        .chart-value {
            width: 50px;
            text-align: right;
            font-weight: 700;
            color: #8b1538;
        }
        
        .config-panel {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 3px solid #dc3545;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .config-title {
            color: #721c24;
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-weight: 700;
            margin-bottom: 8px;
            color: #721c24;
        }
        
        .form-input {
            padding: 12px 15px;
            border: 2px solid #dc3545;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8b1538;
            box-shadow: 0 0 0 3px rgba(139, 21, 56, 0.1);
        }
        
        @media (max-width: 768px) {
            .institutional-header {
                flex-direction: column;
                text-align: center;
            }
            
            .institution-name {
                font-size: 1.8em;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .table-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .back-btn {
                position: static;
                display: inline-block;
                margin-bottom: 20px;
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 350px;
            font-weight: 500;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #ffc72c;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Nuevos estilos para credenciales optimizadas */
        .technology-badge {
            display: inline-block;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 8px;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        .efficiency-highlight {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(32, 201, 151, 0.1));
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .efficiency-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        
        .efficiency-item {
            background: white;
            border-radius: 8px;
            padding: 8px;
            border: 2px solid #28a745;
        }
        
        .efficiency-number {
            font-size: 1.2em;
            font-weight: 900;
            color: #28a745;
            margin-bottom: 2px;
        }
        
        .efficiency-label {
            font-size: 0.7em;
            color: #155724;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <header class="admin-header">
            <a href="index.html" class="back-btn">← Volver al Control</a>
            
            <div class="institutional-header">
                <div class="logo-container">
                    <div class="logo-mini">SEP</div>
                </div>
                
                <div class="institution-info">
                    <div class="institution-name">CETIS No. 45 "José María Izazaga"</div>
                    <div class="institution-subtitle">Centro de Estudios Tecnológicos Industrial y de Servicios</div>
                    <div class="institution-location">Zihuatanejo, Guerrero</div>
                </div>
                
                <div class="logo-container">
                    <div class="logo-mini">DGETI</div>
                </div>
            </div>
            
            <h1 class="admin-title">Panel de Administración Avanzado</h1>
            <p class="admin-subtitle">Sistema de gestión integral con control de retardos automático y credenciales optimizadas</p>
        </header>

        <main class="admin-content">
            <!-- Alerta de estado del sistema -->
            <div class="alert-section">
                <h3 class="alert-title">
                    Estado del Sistema de Control de Retardos y Credenciales
                </h3>
                <div class="alert-content">
                    <strong>Sistema operativo al 100%</strong> | 
                    Control automático de retardos activado | 
                    Tolerancia: 10 minutos | 
                    Límite semanal: 3 retardos | 
                    Horario: 7:00 AM - 2:00 PM |
                    <strong>NUEVO:</strong> Credenciales Optimizadas con QRious 4.0.2 disponibles
                </div>
            </div>

            <!-- Dashboard principal -->
            <div class="dashboard-grid">
                <!-- Estadísticas en tiempo real -->
                <div class="dashboard-card">
                    <h3 class="card-title">Estadísticas en Tiempo Real</h3>
                    <div class="card-content">
                        <div class="stats-mini-grid">
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="totalStudentsAdmin">0</div>
                                <div class="mini-stat-label">Estudiantes Hoy</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="totalRetardosAdmin">0</div>
                                <div class="mini-stat-label">Retardos Hoy</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="totalEntriesAdmin">0</div>
                                <div class="mini-stat-label">Entradas</div>
                            </div>
                            <div class="mini-stat">
                                <div class="mini-stat-number" id="totalExitsAdmin">0</div>
                                <div class="mini-stat-label">Salidas</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="refreshStats()">Actualizar</button>
                            <button class="action-btn secondary" onclick="viewDetailedReport()">Ver Detalles</button>
                        </div>
                    </div>
                </div>

                <!-- Control de retardos -->
                <div class="dashboard-card">
                    <h3 class="card-title">Control de Retardos</h3>
                    <div class="card-content">
                        <p><strong>Sistema automático activado</strong></p>
                        <p>Detecta automáticamente llegadas tardías después de las 7:10 AM</p>
                        <p>Cuenta retardos semanales por estudiante</p>
                        <p>Genera alertas automáticas</p>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="generateRetardosReport()">Reporte Semanal</button>
                            <button class="action-btn secondary" onclick="configureRetardos()">Configurar</button>
                        </div>
                    </div>
                </div>

                <!-- NUEVA: Gestión de credenciales optimizadas -->
                <div class="dashboard-card credentials-optimized">
                    <h3 class="card-title optimized">
                        Credenciales Optimizadas
                        <span class="technology-badge">QRious 4.0.2</span>
                    </h3>
                    <div class="card-content">
                        <p><strong>Sistema revolucionario implementado</strong></p>
                        <div class="efficiency-highlight">
                            <p style="color: #155724; font-weight: 600; margin-bottom: 10px;">Optimización Tecnológica Avanzada</p>
                            <div class="efficiency-stats">
                                <div class="efficiency-item">
                                    <div class="efficiency-number">9</div>
                                    <div class="efficiency-label">Por Hoja</div>
                                </div>
                                <div class="efficiency-item">
                                    <div class="efficiency-number">98%</div>
                                    <div class="efficiency-label">Aprovech.</div>
                                </div>
                                <div class="efficiency-item">
                                    <div class="efficiency-number">400px</div>
                                    <div class="efficiency-label">QR Quality</div>
                                </div>
                                <div class="efficiency-item">
                                    <div class="efficiency-number">125%</div>
                                    <div class="efficiency-label">+ Eficiente</div>
                                </div>
                            </div>
                        </div>
                        <div class="stats-mini-grid">
                            <div class="mini-stat optimized">
                                <div class="mini-stat-number optimized" id="credencialesGeneradas">0</div>
                                <div class="mini-stat-label">Credenciales Generadas</div>
                            </div>
                            <div class="mini-stat optimized">
                                <div class="mini-stat-number optimized" id="papelAhorrado">0</div>
                                <div class="mini-stat-label">Hojas Ahorradas</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn success" onclick="openCredencialesOptimizadas()">Acceder al Sistema</button>
                            <button class="action-btn secondary" onclick="viewCredencialesStats()">Ver Estadísticas</button>
                        </div>
                    </div>
                </div>

                <!-- Reportes y exportación -->
                <div class="dashboard-card">
                    <h3 class="card-title">Reportes y Análisis</h3>
                    <div class="card-content">
                        <p><strong>Informes automáticos</strong></p>
                        <p>Estadísticas diarias, semanales y mensuales</p>
                        <p>Exportación a PDF y Excel</p>
                        <p>Análisis de patrones de asistencia</p>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="generateFullReport()">Reporte Completo</button>
                            <button class="action-btn secondary" onclick="exportData()">Exportar Datos</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuración del sistema -->
            <div class="config-panel">
                <h3 class="config-title">Configuración del Sistema de Retardos</h3>
                <div class="config-form">
                    <div class="form-group">
                        <label class="form-label">Hora de entrada oficial:</label>
                        <input type="time" class="form-input" id="horaEntrada" value="07:00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hora de salida oficial:</label>
                        <input type="time" class="form-input" id="horaSalida" value="14:00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tolerancia (minutos):</label>
                        <input type="number" class="form-input" id="toleranciaMinutos" value="10" min="0" max="30">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Límite retardos/semana:</label>
                        <input type="number" class="form-input" id="limiteRetardos" value="3" min="1" max="10">
                    </div>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="action-btn" onclick="saveConfiguration()">Guardar Configuración</button>
                    <button class="action-btn secondary" onclick="resetConfiguration()">Restaurar Predeterminado</button>
                </div>
            </div>

            <!-- Acciones rápidas -->
            <div class="quick-actions">
                <h3>Acciones Rápidas</h3>
                <div class="quick-grid">
                    <button class="quick-btn" onclick="clearAllData()">Limpiar Datos</button>
                    <button class="quick-btn" onclick="generateSampleData()">Datos de Ejemplo</button>
                    <button class="quick-btn" onclick="exportBackup()">Crear Respaldo</button>
                    <button class="quick-btn" onclick="importBackup()">Importar Respaldo</button>
                    <button class="quick-btn" onclick="systemDiagnostics()">Diagnósticos</button>
                    <button class="quick-btn" onclick="showSystemInfo()">Info del Sistema</button>
                </div>
            </div>

            <!-- Gráfico de asistencia semanal -->
            <div class="data-table">
                <div class="table-header">Estadísticas de Asistencia Semanal</div>
                <div class="table-content">
                    <div class="chart-container">
                        <div class="chart-title">Resumen de los Últimos 7 Días</div>
                        <div class="chart-bar">
                            <div class="chart-label">Lunes</div>
                            <div class="chart-progress"><div class="chart-fill" style="width: 85%"></div></div>
                            <div class="chart-value">85%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Martes</div>
                            <div class="chart-progress"><div class="chart-fill" style="width: 92%"></div></div>
                            <div class="chart-value">92%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Miércoles</div>
                            <div class="chart-progress"><div class="chart-fill" style="width: 78%"></div></div>
                            <div class="chart-value">78%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Jueves</div>
                            <div class="chart-progress"><div class="chart-fill" style="width: 88%"></div></div>
                            <div class="chart-value">88%</div>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-label">Viernes</div>
                            <div class="chart-progress"><div class="chart-fill" style="width: 94%"></div></div>
                            <div class="chart-value">94%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alertas de estudiantes con problemas -->
            <div class="data-table">
                <div class="table-header">Estudiantes que Requieren Atención</div>
                <div class="table-content">
                    <div class="table-row">
                        <div><strong>Estudiante</strong></div>
                        <div><strong>Grado</strong></div>
                        <div><strong>Retardos</strong></div>
                        <div><strong>Ausencias</strong></div>
                        <div><strong>Estado</strong></div>
                    </div>
                    <div class="table-row">
                        <div>PÉREZ GARCÍA JUAN CARLOS<br><small>Mat: 2508CETIS045ZIH1001</small></div>
                        <div>1° A</div>
                        <div>4 esta semana</div>
                        <div>2 este mes</div>
                        <div><span class="status-badge status-critical">Crítico</span></div>
                    </div>
                    <div class="table-row">
                        <div>LÓPEZ MARTÍNEZ MARÍA FERNANDA<br><small>Mat: 2508CETIS045ZIH1002</small></div>
                        <div>1° A</div>
                        <div>2 esta semana</div>
                        <div>1 este mes</div>
                        <div><span class="status-badge status-warning">Atención</span></div>
                    </div>
                    <div class="table-row">
                        <div>GONZÁLEZ RODRÍGUEZ LUIS MIGUEL<br><small>Mat: 2508CETIS045ZIH1003</small></div>
                        <div>1° B</div>
                        <div>0 esta semana</div>
                        <div>0 este mes</div>
                        <div><span class="status-badge status-normal">Normal</span></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer-admin">
            <div class="footer-logos">
                <div class="footer-logo">SEP</div>
                <div class="footer-logo">45</div>
                <div class="footer-logo">DGETI</div>
            </div>
            <div style="font-size: 0.95em; line-height: 1.6; opacity: 0.95;">
                <strong>Panel de Administración Avanzado</strong><br>
                <strong>CETIS No. 45 "José María Izazaga"</strong><br>
                Zihuatanejo, Guerrero - Ciclo Escolar 2025-2026<br>
                Control de Retardos Automático | Credenciales Optimizadas QRious 4.0.2<br>
                #OrgullosamenteCETIS45
            </div>
        </footer>
    </div>

    <script>
        // ================================
        // PANEL DE ADMINISTRACIÓN AVANZADO
        // CON CREDENCIALES OPTIMIZADAS
        // ================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Panel de Administración CETIS 45 iniciado - Con Credenciales Optimizadas');
            loadAdminData();
            updateAdminStats();
            setupAdminEventListeners();
        });

        // Configurar event listeners del admin
        function setupAdminEventListeners() {
            // Ya no necesitamos configurar listeners aquí porque las funciones están inline
            console.log('Event listeners del admin configurados');
        }

        // Cargar datos de administración
        function loadAdminData() {
            try {
                // Cargar estadísticas de credenciales optimizadas
                const credencialesStats = JSON.parse(localStorage.getItem('credencialesOptimizadasStats') || '{"generadas": 0, "hojas_ahorradas": 0}');
                
                document.getElementById('credencialesGeneradas').textContent = credencialesStats.generadas;
                document.getElementById('papelAhorrado').textContent = credencialesStats.hojas_ahorradas;
                
                console.log('Datos de admin cargados');
            } catch (error) {
                console.error('Error cargando datos de admin:', error);
            }
        }

        // Actualizar estadísticas del admin
        function updateAdminStats() {
            try {
                const today = new Date().toISOString().split('T')[0];
                const records = JSON.parse(localStorage.getItem('attendanceRecords') || '[]');
                const todaysRecords = records.filter(record => record.fecha === today);
                
                // Estudiantes únicos
                const uniqueStudents = new Set(todaysRecords.map(record => record.matricula)).size;
                
                // Retardos de hoy
                const retardosHoy = todaysRecords.filter(record => record.esRetardo === true).length;
                
                // Entradas y salidas
                const entriesCount = todaysRecords.filter(record => record.horaEntrada).length;
                const exitsCount = todaysRecords.filter(record => record.horaSalida).length;
                
                // Actualizar DOM
                if (document.getElementById('totalStudentsAdmin')) {
                    document.getElementById('totalStudentsAdmin').textContent = uniqueStudents;
                }
                if (document.getElementById('totalRetardosAdmin')) {
                    document.getElementById('totalRetardosAdmin').textContent = retardosHoy;
                }
                if (document.getElementById('totalEntriesAdmin')) {
                    document.getElementById('totalEntriesAdmin').textContent = entriesCount;
                }
                if (document.getElementById('totalExitsAdmin')) {
                    document.getElementById('totalExitsAdmin').textContent = exitsCount;
                }
                
                console.log('Estadísticas del admin actualizadas');
            } catch (error) {
                console.error('Error actualizando estadísticas del admin:', error);
            }
        }

        // Funciones del panel admin
        function refreshStats() {
            showNotification('Actualizando estadísticas...', 'info', 2000);
            updateAdminStats();
            setTimeout(() => {
                showNotification('Estadísticas actualizadas correctamente', 'success');
            }, 2000);
        }

        function viewDetailedReport() {
            showNotification('Abriendo reporte detallado...', 'info', 2000);
            setTimeout(() => {
                window.open('reportes.html', '_blank');
            }, 1000);
        }

        function generateRetardosReport() {
            showNotification('Generando reporte de retardos...', 'info', 2000);
            // Aquí iría la lógica para generar el reporte
            setTimeout(() => {
                showNotification('Reporte de retardos generado correctamente', 'success');
            }, 2000);
        }

        function configureRetardos() {
            showNotification('Accediendo a configuración de retardos...', 'info', 2000);
            // Scroll hacia la sección de configuración
            document.querySelector('.config-panel').scrollIntoView({ behavior: 'smooth' });
        }

        // NUEVA FUNCIÓN: Abrir credenciales optimizadas
        function openCredencialesOptimizadas() {
            showNotification('Accediendo a Credenciales Optimizadas\nTecnología QRious 4.0.2\nSistema revolucionario implementado', 'info', 3000);
            
            setTimeout(() => {
                window.location.href = 'credenciales-optimizadas.html';
            }, 1500);
        }

        // NUEVA FUNCIÓN: Ver estadísticas de credenciales
        function viewCredencialesStats() {
            const stats = JSON.parse(localStorage.getItem('credencialesOptimizadasStats') || '{"generadas": 0, "hojas_ahorradas": 0}');
            
            const statsMessage = `ESTADÍSTICAS DE CREDENCIALES OPTIMIZADAS
            
Tecnología: QRious 4.0.2
Credenciales generadas: ${stats.generadas}
Hojas ahorradas: ${stats.hojas_ahorradas}
Aprovechamiento: 98% del papel
Eficiencia: 125% mayor que formato anterior

OPTIMIZACIONES LOGRADAS:
• 9 credenciales por hoja A4 (vs 4 anterior)
• QR codes 400px (300 DPI equivalente)
• Reducción 58% en uso de papel
• Compatibilidad con impresoras profesionales
• Códigos QR de máxima calidad y legibilidad

IMPACTO AMBIENTAL:
• Reducción significativa de desperdicio
• Gestión sustentable de recursos
• Optimización ecológica implementada`;

            showNotification(statsMessage, 'info', 10000);
        }

        function generateFullReport() {
            showNotification('Generando reporte completo...', 'info', 2000);
            setTimeout(() => {
                showNotification('Reporte completo generado correctamente', 'success');
            }, 2000);
        }

        function exportData() {
            showNotification('Exportando datos del sistema...', 'info', 2000);
            setTimeout(() => {
                showNotification('Datos exportados correctamente', 'success');
            }, 2000);
        }

        function saveConfiguration() {
            const config = {
                horaEntrada: document.getElementById('horaEntrada').value,
                horaSalida: document.getElementById('horaSalida').value,
                toleranciaMinutos: document.getElementById('toleranciaMinutos').value,
                limiteRetardos: document.getElementById('limiteRetardos').value
            };
            
            localStorage.setItem('sistemaConfig', JSON.stringify(config));
            showNotification('Configuración guardada correctamente', 'success');
        }

        function resetConfiguration() {
            document.getElementById('horaEntrada').value = '07:00';
            document.getElementById('horaSalida').value = '14:00';
            document.getElementById('toleranciaMinutos').value = '10';
            document.getElementById('limiteRetardos').value = '3';
            
            localStorage.removeItem('sistemaConfig');
            showNotification('Configuración restaurada a valores predeterminados', 'info');
        }

        // Funciones de acciones rápidas
        function clearAllData() {
            if (confirm('¿Está seguro de que desea limpiar todos los datos? Esta acción no se puede deshacer.')) {
                localStorage.clear();
                showNotification('Todos los datos han sido limpiados', 'success');
                updateAdminStats();
            }
        }

        function generateSampleData() {
            showNotification('Generando datos de ejemplo...', 'info', 2000);
            // Aquí iría la lógica para generar datos de ejemplo
            setTimeout(() => {
                showNotification('Datos de ejemplo generados correctamente', 'success');
                updateAdminStats();
            }, 2000);
        }

        function exportBackup() {
            try {
                const allData = {
                    attendanceRecords: JSON.parse(localStorage.getItem('attendanceRecords') || '[]'),
                    credencialesStats: JSON.parse(localStorage.getItem('credencialesOptimizadasStats') || '{}'),
                    sistemaConfig: JSON.parse(localStorage.getItem('sistemaConfig') || '{}'),
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup_cetis45_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showNotification('Respaldo exportado correctamente', 'success');
            } catch (error) {
                console.error('Error exportando respaldo:', error);
                showNotification('Error al exportar respaldo', 'error');
            }
        }

        function importBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.attendanceRecords) {
                            localStorage.setItem('attendanceRecords', JSON.stringify(data.attendanceRecords));
                        }
                        if (data.credencialesStats) {
                            localStorage.setItem('credencialesOptimizadasStats', JSON.stringify(data.credencialesStats));
                        }
                        if (data.sistemaConfig) {
                            localStorage.setItem('sistemaConfig', JSON.stringify(data.sistemaConfig));
                        }
                        
                        showNotification('Respaldo importado correctamente', 'success');
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                        
                    } catch (error) {
                        console.error('Error importando respaldo:', error);
                        showNotification('Error al importar respaldo - Archivo inválido', 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function systemDiagnostics() {
            const diagnostics = {
                localStorage: !!window.localStorage,
                attendanceRecords: localStorage.getItem('attendanceRecords') ? 'Disponible' : 'No disponible',
                credencialesStats: localStorage.getItem('credencialesOptimizadasStats') ? 'Disponible' : 'No disponible',
                timestamp: new Date().toLocaleString('es-ES')
            };
            
            const diagnosticsMessage = `DIAGNÓSTICOS DEL SISTEMA
            
Estado del LocalStorage: ${diagnostics.localStorage ? 'Funcional' : 'No funcional'}
Registros de asistencia: ${diagnostics.attendanceRecords}
Estadísticas de credenciales: ${diagnostics.credencialesStats}
Fecha/Hora diagnóstico: ${diagnostics.timestamp}
            
Sistema: Operativo
Control de retardos: Activado
Credenciales optimizadas: Disponible
Tecnología QRious: 4.0.2`;

            showNotification(diagnosticsMessage, 'info', 8000);
        }

        function showSystemInfo() {
            const systemInfo = `INFORMACIÓN DEL SISTEMA
            
CETIS No. 45 "José María Izazaga"
Zihuatanejo, Guerrero
Ciclo Escolar: 2025-2026

MÓDULOS ACTIVOS:
• Control de Asistencia con Retardos
• Panel de Administración Avanzado
• Sistema de Reportes
• Generador de Códigos QR
• Credenciales Optimizadas (QRious 4.0.2)

CARACTERÍSTICAS TÉCNICAS:
• Tolerancia de retardos: 10 minutos
• Límite semanal: 3 retardos
• Horario oficial: 7:00 AM - 2:00 PM
• QR Quality: 400px (300 DPI equiv.)
• Aprovechamiento papel: 98%

DESARROLLADO PARA:
#OrgullosamenteCETIS45`;

            showNotification(systemInfo, 'info', 10000);
        }

        // Función de notificaciones
        function showNotification(message, type = 'success', duration = 4000) {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let bgColor, icon;
            switch(type) {
                case 'error':
                    bgColor = 'linear-gradient(135deg, #dc3545, #c82333)';
                    icon = '⚠';
                    break;
                case 'warning':
                    bgColor = 'linear-gradient(135deg, #ffc107, #e0a800)';
                    icon = '⚠';
                    break;
                case 'info':
                    bgColor = 'linear-gradient(135deg, #17a2b8, #138496)';
                    icon = 'ℹ';
                    break;
                default:
                    bgColor = 'linear-gradient(135deg, #28a745, #20c997)';
                    icon = '✓';
            }
            
            notification.style.background = bgColor;
            notification.style.whiteSpace = 'pre-line';
            notification.innerHTML = `<strong>${icon}</strong> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, duration);
        }

        // Actualizar estadísticas cada minuto
        setInterval(updateAdminStats, 60000);

        console.log('Panel de Administración CETIS 45 cargado completamente');
        console.log('Integración con Credenciales Optimizadas (QRious 4.0.2) activada');
        console.log('Funcionalidades avanzadas disponibles');
    </script>
</body>
</html>
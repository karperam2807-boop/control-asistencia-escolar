<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes de Asistencia - CETIS No. 45 "José María Izazaga" Zihuatanejo</title>
    <link rel="stylesheet" href="styles-unified.css">
</head>
<body>
    <div class="reports-container">
        <!-- Hero Section Mejorado -->
        <header class="reports-hero">
            <div class="reports-hero-content">
                <!-- Header institucional con logos reales -->
                <div class="institutional-header" style="margin-bottom: 20px;">
                    <div class="logo-container">
                        <img src="logos/sep-logo.png" alt="SEP" class="logo-sep" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="logo-placeholder logo-sep" style="display: none; color: #ffc72c;"></div>
                    </div>
                    
                    <div class="institution-info">
                        <img src="logos/cetis45-logo.png" alt="CETIS 45" class="logo-cetis-center" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="logo-cetis-center" style="display: none;"></div>
                        
                        <div class="institution-name" style="color: #ffc72c;">CETIS No. 45 "José María Izazaga"</div>
                        <div class="institution-subtitle">Centro de Estudios Tecnológicos Industrial y de Servicios</div>
                        <div class="institution-location">Zihuatanejo, Guerrero</div>
                    </div>
                    
                    <div class="logo-container">
                        <img src="logos/dgeti-logo.png" alt="DGETI" class="logo-dgeti" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="logo-placeholder logo-dgeti" style="display: none; color: #ffc72c;"></div>
                    </div>
                </div>
                
                <h1 class="reports-title">📊 Reportes de Asistencia</h1>
                <p class="reports-subtitle">Sistema de análisis y seguimiento estudiantil</p>
                
                <div class="breadcrumb">
                    <a href="index.html">🏠 Control de Asistencia</a> / 📊 Reportes
                </div>
            </div>
        </header>

        <!-- Sección de Controles Mejorada -->
        <section class="controls-section">
            <div class="controls-grid">
                <div class="date-controls">
                    <span class="date-label">📅 Seleccionar fecha:</span>
                    <input type="date" id="dateInput" class="date-input">
                    <div class="filter-buttons">
                        <button id="filterBtn" class="filter-btn">🔍 Filtrar</button>
                        <button id="todayBtn" class="filter-btn secondary">📅 Hoy</button>
                        <button id="weekBtn" class="filter-btn secondary">📆 Esta semana</button>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <button class="filter-btn" onclick="verifyAndRepairData()" title="Verificar datos">
                        🔧 Verificar
                    </button>
                </div>
            </div>
        </section>

        <!-- Sección de Estadísticas Mejorada -->
        <section class="stats-section">
            <div class="stats-header">
                <h2>📈 Resumen de Asistencia</h2>
                <p class="stats-period" id="statsPeriod">Datos del día seleccionado</p>
            </div>
            
            <div class="summary-cards">
                <div class="summary-card students">
                    <div class="summary-number" id="summaryStudents">0</div>
                    <div class="summary-label">
                        <span class="summary-icon">👥</span>
                        Estudiantes únicos
                    </div>
                </div>
                <div class="summary-card present">
                    <div class="summary-number" id="summaryPresent">0</div>
                    <div class="summary-label">
                        <span class="summary-icon">✅</span>
                        Presentes
                    </div>
                </div>
                <div class="summary-card complete">
                    <div class="summary-number" id="summaryComplete">0</div>
                    <div class="summary-label">
                        <span class="summary-icon">🔄</span>
                        Entrada y salida
                    </div>
                </div>
                <div class="summary-card percentage">
                    <div class="summary-number" id="summaryPercentage">0%</div>
                    <div class="summary-label">
                        <span class="summary-icon">📊</span>
                        % Asistencia
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Tabla Mejorada -->
        <section class="table-section">
            <div class="table-header-section">
                <h2 class="table-title">📋 Detalle de Registros</h2>
                <div class="table-info" id="recordsCount">
                    Cargando datos...
                </div>
            </div>
            
            <div class="report-table-container">
                <div class="table-header">
                    <div>👤 Estudiante</div>
                    <div>🎓 Grado</div>
                    <div>🟢 Entrada</div>
                    <div>🔴 Salida</div>
                    <div>📊 Estado</div>
                </div>
                <div class="table-body" id="reportTableBody">
                    <div class="no-data">
                        <div class="no-data-icon">📊</div>
                        <h3>Sistema de Reportes CETIS No. 45</h3>
                        <p><strong>Selecciona una fecha para visualizar los registros de asistencia</strong></p>
                        <p>Los datos se actualizan automáticamente desde el sistema principal</p>
                        <div class="no-data-actions">
                            <button onclick="addSampleData()" class="filter-btn">
                                🎯 Añadir Datos de Ejemplo
                            </button>
                            <button onclick="generateMultipleDaysData()" class="filter-btn secondary">
                                📅 Generar Datos Históricos
                            </button>
                        </div>
                        <small style="margin-top: 20px; display: block; opacity: 0.7;">#OrgullosamenteCETIS45</small>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Exportación Mejorada -->
        <section class="export-section">
            <div class="export-header">
                <h2 class="export-title">📤 Exportar Reportes</h2>
                <p class="export-description">Descarga los datos en diferentes formatos para análisis externo</p>
            </div>
            
            <div class="export-buttons">
                <button id="exportPdfBtn" class="export-btn pdf">
                    📄 Exportar PDF
                    <small style="font-size: 0.8em; opacity: 0.8;">Reporte completo</small>
                </button>
                <button id="exportExcelBtn" class="export-btn excel">
                    📊 Exportar Excel
                    <small style="font-size: 0.8em; opacity: 0.8;">Datos sin procesar</small>
                </button>
                <button id="printReportBtn" class="export-btn">
                    🖨️ Imprimir Reporte
                    <small style="font-size: 0.8em; opacity: 0.8;">Vista optimizada</small>
                </button>
            </div>
        </section>

        <!-- Footer institucional -->
        <footer class="app-footer">
            <div class="footer-logos">
                <img src="logos/sep-logo.png" alt="SEP" class="footer-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo" style="display: none;">SEP</div>
                
                <img src="logos/cetis45-logo.png" alt="CETIS 45" class="footer-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo" style="display: none;">45</div>
                
                <img src="logos/dgeti-logo.png" alt="DGETI" class="footer-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo" style="display: none;">DGETI</div>
            </div>
            <div class="footer-text">
                <strong>Sistema de Reportes de Asistencia</strong><br>
                <strong>CETIS No. 45 "José María Izazaga"</strong><br>
                Zihuatanejo, Guerrero - Ciclo Escolar 2025-2026<br>
                #OrgullosamenteCETIS45
            </div>
        </footer>
    </div>

    <script src="reportes.js"></script>
    <script>
        // Mejorar la experiencia de usuario
        document.addEventListener('DOMContentLoaded', function() {
            // Actualizar contador de registros
            function updateRecordsCount() {
                const countElement = document.getElementById('recordsCount');
                const periodElement = document.getElementById('statsPeriod');
                
                if (countElement && typeof filteredRecords !== 'undefined') {
                    const count = filteredRecords.length;
                    countElement.textContent = `${count} registro${count !== 1 ? 's' : ''} encontrado${count !== 1 ? 's' : ''}`;
                }
                
                if (periodElement) {
                    const dateInput = document.getElementById('dateInput');
                    if (dateInput && dateInput.value) {
                        const date = new Date(dateInput.value + 'T00:00:00');
                        const formattedDate = date.toLocaleDateString('es-ES', {
                            weekday: 'long',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        periodElement.textContent = `Datos del ${formattedDate}`;
                    } else {
                        periodElement.textContent = 'Datos del día seleccionado';
                    }
                }
            }
            
            // Observar cambios en la tabla
            if (typeof window.updateReportDisplay === 'function') {
                const originalUpdateReportDisplay = window.updateReportDisplay;
                window.updateReportDisplay = function() {
                    originalUpdateReportDisplay();
                    updateRecordsCount();
                };
            }
            
            // Mejorar botones de filtro
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Efecto visual de clic
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });
            
            // Añadir tooltips informativos
            const dateInput = document.getElementById('dateInput');
            if (dateInput) {
                dateInput.setAttribute('title', 'Selecciona una fecha específica para ver los registros de asistencia');
            }
            
            // Configurar event listeners principales
            const filterBtn = document.getElementById('filterBtn');
            const todayBtn = document.getElementById('todayBtn');
            const weekBtn = document.getElementById('weekBtn');
            
            if (filterBtn && typeof filterByDate === 'function') {
                filterBtn.addEventListener('click', filterByDate);
            }
            
            if (todayBtn && typeof filterToday === 'function') {
                todayBtn.addEventListener('click', filterToday);
            }
            
            if (weekBtn && typeof filterThisWeek === 'function') {
                weekBtn.addEventListener('click', filterThisWeek);
            }
            
            // Inicializar contador
            setTimeout(updateRecordsCount, 1000);
            
            console.log('✅ Reportes mejorados cargados correctamente');
            console.log('🏫 CETIS No. 45 "José María Izazaga" - Zihuatanejo, Guerrero');
        });
        
        // Función para mostrar loading en botones
        function showButtonLoading(buttonId, originalText) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.disabled = true;
                button.innerHTML = '⏳ Procesando...';
                
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = originalText;
                }, 2000);
            }
        }
        
        // Mejorar botones de exportación
        document.getElementById('exportPdfBtn')?.addEventListener('click', function() {
            showButtonLoading('exportPdfBtn', '📄 Exportar PDF<small style="font-size: 0.8em; opacity: 0.8;">Reporte completo</small>');
            if (typeof exportData === 'function') {
                exportData();
            }
        });
        
        document.getElementById('exportExcelBtn')?.addEventListener('click', function() {
            showButtonLoading('exportExcelBtn', '📊 Exportar Excel<small style="font-size: 0.8em; opacity: 0.8;">Datos sin procesar</small>');
            if (typeof exportData === 'function') {
                exportData();
            }
        });
        
        document.getElementById('printReportBtn')?.addEventListener('click', function() {
            showButtonLoading('printReportBtn', '🖨️ Imprimir Reporte<small style="font-size: 0.8em; opacity: 0.8;">Vista optimizada</small>');
            window.print();
        });
        
        console.log('📊 Sistema de Reportes - CETIS No. 45 "José María Izazaga"');
        console.log('📍 Zihuatanejo, Guerrero - Ciclo 2025-2026');
    </script>
</body>
</html>
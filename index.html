<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Asistencia - CETIS No. 45 "José María Izazaga" Zihuatanejo</title>
    <link rel="stylesheet" href="styles-unified.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8b1538">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="CETIS 45 - Asistencia">
    <meta name="description" content="Sistema de Control de Asistencia Escolar - Centro de Estudios Tecnológicos Industrial y de Servicios No. 45 José María Izazaga - Zihuatanejo, Guerrero">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <!-- Header institucional con logos reales -->
            <div class="institutional-header">
                <div class="logo-container">
                    <img src="logos/sep-logo.png" alt="SEP" class="logo-sep" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="logo-placeholder logo-sep" style="display: none;"></div>
                </div>
                
                <div class="institution-info">
                    <img src="logos/cetis45-logo.png" alt="CETIS 45" class="logo-cetis-center" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="logo-cetis-center" style="display: none;"></div>
                    
                    <div class="institution-name">CETIS No. 45 "José María Izazaga"</div>
                    <div class="institution-subtitle">Centro de Estudios Tecnológicos Industrial y de Servicios</div>
                    <div class="institution-location">Zihuatanejo, Guerrero</div>
                </div>
                
                <div class="logo-container">
                    <img src="logos/dgeti-logo.png" alt="DGETI" class="logo-dgeti" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="logo-placeholder logo-dgeti" style="display: none;"></div>
                </div>
            </div>
            
            <h1 class="app-title">🏫 Control de Asistencia</h1>
            <div class="date-display" id="currentDate"></div>
        </header>

        <main class="main-content">
            <!-- Sección de escaneo mejorada -->
            <div class="scan-section">
                <button id="scanButton" class="scan-btn">
                    📱 Escanear Código QR
                </button>
                <div class="scan-description">
                    Acerca el código QR del estudiante a la cámara
                </div>
                <div id="camera-container" class="camera-container hidden">
                    <video id="video" autoplay></video>
                    <canvas id="canvas" class="hidden"></canvas>
                    <button id="stopScanBtn" class="stop-btn">❌ Cerrar Cámara</button>
                </div>
            </div>

            <!-- Estadísticas del día mejoradas -->
            <div class="stats-section">
                <h2 class="section-title">📊 Estadísticas de Hoy</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStudents">0</div>
                        <div class="stat-label">👥 Estudiantes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalEntries">0</div>
                        <div class="stat-label">🟢 Entradas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalExits">0</div>
                        <div class="stat-label">🔴 Salidas</div>
                    </div>
                </div>
            </div>

            <!-- Lista de registros mejorada -->
            <div class="records-section">
                <h2 class="section-title">📋 Registros de Hoy</h2>
                <div id="recordsList" class="records-list">
                    <div class="no-records">
                        <strong>📱 ¡Listo para escanear!</strong><br>
                        No hay registros aún. Escanea el primer código QR para comenzar.<br>
                        <small style="color: #8b1538; margin-top: 10px; display: block;">#OrgullosamenteCETIS45</small>
                    </div>
                </div>
            </div>

            <!-- Botones de navegación mejorados -->
            <div class="nav-buttons">
                <button id="reportsBtn" class="nav-btn">
                    📈 Ver Reportes
                </button>
                <button id="exportBtn" class="nav-btn">
                    📤 Exportar Datos
                </button>
                <button id="generatorBtn" class="nav-btn">
                    🎫 Generar Códigos QR
                </button>
                <button id="helpBtn" class="nav-btn">
                    ❓ Ayuda
                </button>
            </div>
        </main>

        <!-- Footer institucional mejorado -->
        <footer class="app-footer">
            <div class="footer-logos">
                <img src="logos/sep-logo.png" alt="SEP" class="footer-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo" style="display: none;">SEP</div>
                
                <img src="logos/cetis45-logo.png" alt="CETIS 45" class="footer-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo" style="display: none;">45</div>
                
                <img src="logos/dgeti-logo.png" alt="DGETI" class="footer-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="footer-logo" style="display: none;">DGETI</div>
            </div>
            <div class="footer-text">
                <strong>Sistema de Control de Asistencia Escolar</strong><br>
                <strong>CETIS No. 45 "José María Izazaga"</strong><br>
                Zihuatanejo, Guerrero - Ciclo Escolar 2025-2026<br>
                #OrgullosamenteCETIS45
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="app.js"></script>
    
    <script>
        // Event listeners para los botones corregidos
        document.addEventListener('DOMContentLoaded', function() {
            const generatorBtn = document.getElementById('generatorBtn');
            const helpBtn = document.getElementById('helpBtn');
            const reportsBtn = document.getElementById('reportsBtn');
            
            // Botón generador de códigos QR
            if (generatorBtn) {
                generatorBtn.addEventListener('click', function() {
                    console.log('🎫 Navegando al generador de códigos QR...');
                    window.location.href = 'generador.html';
                });
            }
            
            // Botón de reportes
            if (reportsBtn) {
                reportsBtn.addEventListener('click', function() {
                    console.log('📈 Navegando a reportes...');
                    window.location.href = 'reportes.html';
                });
            }
            
            // Botón de ayuda
            if (helpBtn) {
                helpBtn.addEventListener('click', function() {
                    showHelpModal();
                });
            }
            
            console.log('✅ Event listeners configurados correctamente');
        });
        
        // Función de ayuda actualizada
        function showHelpModal() {
            const helpContent = `
🏫 SISTEMA DE CONTROL DE ASISTENCIA
   CETIS No. 45 "José María Izazaga"
   Zihuatanejo, Guerrero

📱 CÓMO USAR:
1. Presiona "Escanear Código QR"
2. Permite acceso a la cámara
3. Acerca el código del estudiante
4. Primera lectura = ENTRADA ✅
5. Segunda lectura = SALIDA ❌

🎫 GENERAR CÓDIGOS QR:
• Individual: Un estudiante a la vez
• Masivo: Lista completa en CSV
• Credenciales profesionales para imprimir

📊 REPORTES DISPONIBLES:
• Estadísticas diarias en tiempo real
• Filtros por fecha específica
• Exportación a Excel/PDF

💡 CONSEJOS IMPORTANTES:
• Mantén buena iluminación para escanear
• Los datos se guardan automáticamente
• Funciona sin internet después de cargar
• Usa códigos QR generados por el sistema

🔧 SOPORTE TÉCNICO:
• Dirección del CETIS No. 45
• Departamento de Sistemas
• #OrgullosamenteCETIS45

📱 FORMATO DE CÓDIGO QR:
{"matricula":"123","nombre":"Juan Pérez","grado":"1","grupo":"A"}
            `;
            
            // Mostrar notificación en lugar de alert
            if (typeof showNotification === 'function') {
                showNotification(helpContent, 'info', 10000);
            } else {
                alert(helpContent);
            }
        }
        
        console.log('🏫 Sistema CETIS 45 - Index cargado correctamente');
        console.log('📂 Enlaces corregidos para usar logos reales');
        console.log('🎯 Header actualizado con logos institucionales');
    </script>
</body>
</html>